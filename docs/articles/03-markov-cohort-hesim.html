<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Markov Cohort Model with hesim • rcea</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Markov Cohort Model with hesim">
<meta property="og:description" content="rcea">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-131661920-3"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-131661920-3');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rcea</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/01-markov-cohort.html">Simple Markov Cohort Model</a>
    </li>
    <li>
      <a href="../articles/02-markov-cohort-psa.html">Incorporating Probabilistic Sensitivity Analysis</a>
    </li>
    <li>
      <a href="../articles/03-markov-cohort-hesim.html">Markov Cohort Model with hesim</a>
    </li>
    <li>
      <a href="../articles/04-mstate.html">Semi-Markov Multi-state Model</a>
    </li>
    <li>
      <a href="../articles/05-psm.html">Partitioned Survival Model</a>
    </li>
    <li>
      <a href="../articles/06-cea.html">Cost-effectiveness Analysis</a>
    </li>
    <li class="divider">
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Slides
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../slides-3hr.pdf">3 hour course</a>
    </li>
    <li>
      <a href="../slides-4hr.pdf">4 hour course</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/hesim-dev/rcea/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="03-markov-cohort-hesim_files/header-attrs-2.9/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Markov Cohort Model with hesim</h1>
            
            <h4 class="date">2021-08-13</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/hesim-dev/rcea/blob/master/vignettes/03-markov-cohort-hesim.Rmd"><code>vignettes/03-markov-cohort-hesim.Rmd</code></a></small>
      <div class="hidden name"><code>03-markov-cohort-hesim.Rmd</code></div>

    </div>

    
    
<div id="overview" class="section level1">
<h1 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h1>
<p>This tutorial repeats the probabilistic sensitivity analysis (PSA) of the Markov cohort model simulation performed in the <a href="02-markov-cohort-psa.html">previous tutorial</a> using <code>hesim</code>. We utilize the cohort discrete time state transition model (<code>cDTSTM</code>) class, which is another name for a (time-homogeneous or time-inhomogeneous) Markov cohort model.</p>
<p>More information about <code>hesim</code> can be found by visiting the <a href="https://hesim-dev.github.io/hesim/">package website</a>. We recommend reading the “Articles”—starting with the <a href="https://hesim-dev.github.io/hesim/articles/intro.html">“Introduction to <code>hesim</code>”</a>—to learn more. Economic models can, in general, be simulated with the following steps:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Model setup:</strong> Specify the treatment strategies, target population(s), and model structure.</li>
<li>
<strong>Parameters:</strong> Estimate or define the parameters of the economic model.</li>
<li>
<strong>Simulation:</strong>
<ol style="list-style-type: lower-alpha">
<li>
<strong>Construction of model:</strong> Create an economic model—consisting of separate statistical models for disease progression, costs, and utilities—that simulate outcomes as a function of <em>input data</em> (derived from Step 1) and <em>parameters</em> (from Step 2).</li>
<li>
<strong>Simulation of outcomes:</strong> Simulate outcomes (disease progression, costs, and quality-adjusted life-years (QALYs)) using the model constructed in Step 3.</li>
</ol>
</li>
</ol>
<p>This analysis can be performed using the <code>hesim</code> package alone.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://hesim-dev.github.io/hesim/">"hesim"</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="model-setup" class="section level1">
<h1 class="hasAnchor">
<a href="#model-setup" class="anchor"></a>Model setup</h1>
<p>Before beginning an analysis, it is necessary to define the treatment strategies of interest and the the target population of interest. We continue to run an analysis for two treatment strategies (“SOC” and the “New” treatment) and one representative 25-year old patient.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">strategies</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
  strategy_id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,
  strategy_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"SOC"</span>, <span class="st">"New"</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">patients</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
  patient_id <span class="op">=</span> <span class="fl">1</span>,
  age <span class="op">=</span> <span class="fl">25</span>
<span class="op">)</span>
<span class="va">hesim_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://hesim-dev.github.io/hesim/reference/hesim_data.html">hesim_data</a></span><span class="op">(</span>
  strategies <span class="op">=</span> <span class="va">strategies</span>,
  patients <span class="op">=</span> <span class="va">patients</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">hesim_dat</span><span class="op">)</span></code></pre></div>
<pre><code>## $strategies
##   strategy_id strategy_name
## 1           1           SOC
## 2           2           New
## 
## $patients
##   patient_id age
## 1          1  25
## 
## attr(,"class")
## [1] "hesim_data"</code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">labs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://hesim-dev.github.io/hesim/reference/get_labels.html">get_labels</a></span><span class="op">(</span><span class="va">hesim_dat</span><span class="op">)</span></code></pre></div>
</div>
<div id="model-parameters" class="section level1">
<h1 class="hasAnchor">
<a href="#model-parameters" class="anchor"></a>Model parameters</h1>
<p>We will use the same list of parameters as in the previous tutorial.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  alpha_soc <span class="op">=</span> <span class="va">transitions_soc</span>,
  lrr_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">.8</span><span class="op">)</span>,
  lrr_lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">.71</span><span class="op">)</span>,
  lrr_upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">.9</span><span class="op">)</span>,
  c_medical <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>H <span class="op">=</span> <span class="fl">2000</span>, S1 <span class="op">=</span> <span class="fl">4000</span>, S2 <span class="op">=</span> <span class="fl">15000</span><span class="op">)</span>,
  c_soc <span class="op">=</span> <span class="fl">2000</span>,
  c_new <span class="op">=</span> <span class="fl">12000</span>,
  u_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>H <span class="op">=</span> <span class="fl">1</span>, S1 <span class="op">=</span> <span class="fl">.75</span>, S2 <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,
  u_se <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>H <span class="op">=</span> <span class="fl">0</span>, S1 <span class="op">=</span> <span class="fl">0.03</span>, S2 <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<div id="random-number-generation" class="section level2">
<h2 class="hasAnchor">
<a href="#random-number-generation" class="anchor"></a>Random number generation</h2>
<p>The random number generation process for the PSA is once again defined using <code><a href="https://hesim-dev.github.io/hesim/reference/define_rng.html">define_rng()</a></code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rng_def</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://hesim-dev.github.io/hesim/reference/define_rng.html">define_rng</a></span><span class="op">(</span><span class="op">{</span>
  <span class="va">lrr_se</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">lrr_upper</span> <span class="op">-</span> <span class="va">lrr_lower</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op">(</span><span class="fl">.975</span><span class="op">)</span><span class="op">)</span> <span class="co"># Local object </span>
  <span class="co"># not returned</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span> <span class="co"># Parameters to return</span>
    p_soc <span class="op">=</span> <span class="fu"><a href="https://hesim-dev.github.io/hesim/reference/rng_distributions.html">dirichlet_rng</a></span><span class="op">(</span><span class="va">alpha_soc</span><span class="op">)</span>,
    rr_new <span class="op">=</span> <span class="fu"><a href="https://hesim-dev.github.io/hesim/reference/rng_distributions.html">lognormal_rng</a></span><span class="op">(</span><span class="va">lrr_mean</span>, <span class="va">lrr_se</span><span class="op">)</span>,
    c_medical <span class="op">=</span> <span class="fu"><a href="https://hesim-dev.github.io/hesim/reference/rng_distributions.html">gamma_rng</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="va">c_medical</span>, sd <span class="op">=</span> <span class="va">c_medical</span><span class="op">)</span>,
    c_soc <span class="op">=</span> <span class="va">c_soc</span>,
    c_new <span class="op">=</span> <span class="va">c_new</span>,
    u <span class="op">=</span> <span class="fu"><a href="https://hesim-dev.github.io/hesim/reference/rng_distributions.html">beta_rng</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="va">u_mean</span>, sd <span class="op">=</span> <span class="va">u_se</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span>, n <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></code></pre></div>
</div>
<div id="transformed-parameters" class="section level2">
<h2 class="hasAnchor">
<a href="#transformed-parameters" class="anchor"></a>Transformed parameters</h2>
<p>Economic models in <code>hesim</code> consist of separate statistical models used to simulate disease progression, costs, and utility. Like any prediction model, each statistical model simulates outcomes as a function of input data and model parameters. In most statistical models, the underlying parameters (see <code><a href="https://hesim-dev.github.io/hesim/reference/params.html">hesim::params</a></code>) are transformed (see <code><a href="https://hesim-dev.github.io/hesim/reference/tparams.html">hesim::tparams</a></code>) into more relevant parameters for prediction (e.g., the coefficients and covariates from a Weibull regression are used to predict shape and scale parameters).</p>
<p>There are multiple ways to “transform” parameters in <code>hesim</code>. In this example, we will use mathematical expressions via <code><a href="https://hesim-dev.github.io/hesim/reference/define_tparams.html">hesim::define_tparams()</a></code> (designed for Markov cohort models), whereas the next tutorial on multi-state modeling will estimate parameters (see <code><a href="https://hesim-dev.github.io/hesim/reference/params_surv.html">hesim::params_surv</a></code>) by fitting parametric survival models.</p>
<p>Transformed parameters are modeled here as function of treatment strategies and patients, which can be generated using <code><a href="https://hesim-dev.github.io/hesim/reference/expand.html">hesim::expand()</a></code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">input_data</span> <span class="op">&lt;-</span> <span class="fu">hesim</span><span class="fu">::</span><span class="fu"><a href="https://hesim-dev.github.io/hesim/reference/expand.html">expand</a></span><span class="op">(</span><span class="va">hesim_dat</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"strategies"</span>, <span class="st">"patients"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">input_data</span><span class="op">)</span></code></pre></div>
<pre><code>##    strategy_id patient_id strategy_name age
## 1:           1          1           SOC  25
## 2:           2          1           New  25</code></pre>
<p>Operations in a <code><a href="https://hesim-dev.github.io/hesim/reference/define_tparams.html">define_tparams()</a></code> block are performed using the columns from the input data. To maximize computational efficiency, all operations are vectorized across the rows in the data and PSA samples. Parameters not included in a transformed parameter function are assumed constant across patients and treatment strategies. A list must be returned with the following possible elements:</p>
<ul>
<li>
<strong>tpmatrix</strong>: The transition probability matrix used to simulate transition probabilities in the economic model.</li>
<li>
<strong>utility</strong>: The utility values to attach to states and used to simulate QALYs in the economic model. Either a vector (in which case utility is the same in each health state) or a matrix with a column for each (non-death) health state.</li>
<li>
<strong>costs</strong>: A named list of costs for each category used to simulate costs in the economic model. Each element of the list must be in the same format as utility.</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tparams_def</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://hesim-dev.github.io/hesim/reference/define_tparams.html">define_tparams</a></span><span class="op">(</span><span class="op">{</span>
  <span class="co">## The treatment effect (relative risk) is transformed so that it varies by </span>
  <span class="co">## strategies (SOC is the reference strategy)</span>
  <span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">ifelse</a></span><span class="op">(</span><span class="va">strategy_name</span> <span class="op">==</span> <span class="st">"SOC"</span>, <span class="fl">1</span>, <span class="va">rr_new</span><span class="op">)</span>
  
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    tpmatrix <span class="op">=</span> <span class="fu"><a href="https://hesim-dev.github.io/hesim/reference/tpmatrix.html">tpmatrix</a></span><span class="op">(</span>
      <span class="va">C</span>,          <span class="va">p_soc</span><span class="op">$</span><span class="va">h_s1</span> <span class="op">*</span> <span class="va">rr</span>, <span class="va">p_soc</span><span class="op">$</span><span class="va">h_s2</span> <span class="op">*</span> <span class="va">rr</span>,  <span class="va">p_soc</span><span class="op">$</span><span class="va">h_d</span> <span class="op">*</span> <span class="va">rr</span>,
      <span class="va">p_soc</span><span class="op">$</span><span class="va">s1_h</span>, <span class="va">C</span>,               <span class="va">p_soc</span><span class="op">$</span><span class="va">s1_s2</span> <span class="op">*</span> <span class="va">rr</span>, <span class="va">p_soc</span><span class="op">$</span><span class="va">s1_d</span> <span class="op">*</span> <span class="va">rr</span>,
      <span class="va">p_soc</span><span class="op">$</span><span class="va">s2_h</span>, <span class="va">p_soc</span><span class="op">$</span><span class="va">s2_s1</span>,     <span class="va">C</span>,                <span class="va">p_soc</span><span class="op">$</span><span class="va">s2_d</span> <span class="op">*</span> <span class="va">rr</span>,
      <span class="fl">0</span>,          <span class="fl">0</span>,               <span class="fl">0</span>,                <span class="fl">1</span>
    <span class="op">)</span>,
    utility <span class="op">=</span> <span class="va">u</span>,
    costs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
      treatment <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">ifelse</a></span><span class="op">(</span><span class="va">strategy_name</span> <span class="op">==</span> <span class="st">"SOC"</span>, <span class="va">c_soc</span>, <span class="va">c_new</span><span class="op">)</span>,
      medical <span class="op">=</span> <span class="va">c_medical</span>
    <span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="simulation" class="section level1">
<h1 class="hasAnchor">
<a href="#simulation" class="anchor"></a>Simulation</h1>
<div id="construct-the-model" class="section level2">
<h2 class="hasAnchor">
<a href="#construct-the-model" class="anchor"></a>Construct the model</h2>
<p>The economic model is defined by using <code><a href="https://hesim-dev.github.io/hesim/reference/define_model.html">define_model()</a></code> to combine the underlying parameters with the expressions for random number generation and parameter transformation.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod_def</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://hesim-dev.github.io/hesim/reference/define_model.html">define_model</a></span><span class="op">(</span>tparams_def <span class="op">=</span> <span class="va">tparams_def</span>, 
                        rng_def <span class="op">=</span> <span class="va">rng_def</span>, 
                        params <span class="op">=</span> <span class="va">params</span><span class="op">)</span></code></pre></div>
<p>An economic model (of class <code>CohortDtstm</code>) can then be created from the defined model and input data using the generic function <code><a href="https://hesim-dev.github.io/hesim/reference/create_CohortDtstm.html">create_CohortDtstm()</a></code>. The economic model is an <code>R6</code> object consisting of a transition model for simulating transition probabilities with <code><a href="https://hesim-dev.github.io/hesim/reference/sim_stateprobs.html">sim_stateprobs()</a></code>, a utility model for simulating QALYs with <code><a href="https://hesim-dev.github.io/hesim/reference/sim_ev.html">sim_qalys()</a></code>, and a set of cost models (for each cost category) for simulating costs with <code><a href="https://hesim-dev.github.io/hesim/reference/sim_ev.html">sim_costs()</a></code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">econmod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://hesim-dev.github.io/hesim/reference/create_CohortDtstm.html">create_CohortDtstm</a></span><span class="op">(</span><span class="va">mod_def</span>, <span class="va">input_data</span><span class="op">)</span></code></pre></div>
</div>
<div id="simulating-outcomes" class="section level2">
<h2 class="hasAnchor">
<a href="#simulating-outcomes" class="anchor"></a>Simulating outcomes</h2>
<div id="health-state-probabilities" class="section level3">
<h3 class="hasAnchor">
<a href="#health-state-probabilities" class="anchor"></a>Health state probabilities</h3>
<p>State occupancy probabilities are generated by simulating the discrete time Markov chain.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">econmod</span><span class="op">$</span><span class="fu">sim_stateprobs</span><span class="op">(</span>n_cycles <span class="op">=</span> <span class="fl">85</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">econmod</span><span class="op">$</span><span class="va">stateprobs_</span><span class="op">)</span></code></pre></div>
<pre><code>##    sample strategy_id patient_id grp_id state_id t      prob
## 1:      1           1          1      1        1 0 1.0000000
## 2:      1           1          1      1        1 1 0.8703459
## 3:      1           1          1      1        1 2 0.8250446
## 4:      1           1          1      1        1 3 0.8024778
## 5:      1           1          1      1        1 4 0.7861723
## 6:      1           1          1      1        1 5 0.7717218</code></pre>
</div>
<div id="costs-and-qalys" class="section level3">
<h3 class="hasAnchor">
<a href="#costs-and-qalys" class="anchor"></a>Costs and QALYs</h3>
<p>Costs and QALYs are computed by integrating the previously simulated state probabilities. To maintain consistency with our prior analyses, we measure costs and QALYs at the start of each model cycle using a left Riemann sum. We use the option <code>lys = TRUE</code> so that life-years are simulated in addition to QALYs.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">econmod</span><span class="op">$</span><span class="fu">sim_qalys</span><span class="op">(</span>dr <span class="op">=</span> <span class="fl">0.03</span>, lys <span class="op">=</span> <span class="cn">TRUE</span>, integrate_method <span class="op">=</span> <span class="st">"riemann_right"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">econmod</span><span class="op">$</span><span class="va">qalys_</span><span class="op">)</span></code></pre></div>
<pre><code>##    sample strategy_id patient_id grp_id state_id   dr     qalys       lys
## 1:      1           1          1      1        1 0.03 16.980147 16.980147
## 2:      1           1          1      1        2 0.03  2.574968  3.543340
## 3:      1           1          1      1        3 0.03  2.958624  6.016953
## 4:      1           2          1      1        1 0.03 19.525390 19.525390
## 5:      1           2          1      1        2 0.03  2.435161  3.350955
## 6:      1           2          1      1        3 0.03  2.372067  4.824072</code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">econmod</span><span class="op">$</span><span class="fu">sim_costs</span><span class="op">(</span>dr <span class="op">=</span> <span class="fl">0.03</span>, integrate_method <span class="op">=</span> <span class="st">"riemann_right"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">econmod</span><span class="op">$</span><span class="va">costs_</span><span class="op">)</span></code></pre></div>
<pre><code>##    sample strategy_id patient_id grp_id state_id   dr  category     costs
## 1:      1           1          1      1        1 0.03 treatment  33960.29
## 2:      1           1          1      1        2 0.03 treatment   7086.68
## 3:      1           1          1      1        3 0.03 treatment  12033.91
## 4:      1           2          1      1        1 0.03 treatment 234304.68
## 5:      1           2          1      1        2 0.03 treatment  40211.46
## 6:      1           2          1      1        3 0.03 treatment  57888.87</code></pre>
</div>
</div>
</div>
<div id="cost-effectiveness-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#cost-effectiveness-analysis" class="anchor"></a>Cost-effectiveness analysis</h1>
<p>Cost-effectiveness analyses (CEAs) can be performed directly from the simulation output with <code>hesim</code>. Other R packages such as <a href="https://sites.google.com/a/statistica.it/gianluca/bcea">BCEA</a> could also be considered. To perform the CEA, we will first need to sum costs and QALYs across health states.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ce_sim</span> <span class="op">&lt;-</span> <span class="va">econmod</span><span class="op">$</span><span class="fu">summarize</span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">ce_sim</span>,  file <span class="op">=</span> <span class="st">"markov-cohort-hesim-ce_sim.rds"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">hesim_dat</span>,  file <span class="op">=</span> <span class="st">"markov-cohort-hesim_data.rds"</span><span class="op">)</span></code></pre></div>
<p>The analysis can then be performed directly from this output using the <code><a href="https://hesim-dev.github.io/hesim/reference/cea.html">hesim::cea()</a></code> and <code><a href="https://hesim-dev.github.io/hesim/reference/cea.html">hesim::cea_pw()</a></code> functions. The former considers all treatment strategies simultaneously while the latter makes pairwise comparisons of each treatment strategies to a comparator (in our example the SOC). A complete analysis will be provided in the <a href="06-cea.html">CEA tutorial</a> using the output saved above; for now, we perform a simple pairwise analysis:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cea_pw_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://hesim-dev.github.io/hesim/reference/cea.html">cea_pw</a></span><span class="op">(</span><span class="va">ce_sim</span>, comparator <span class="op">=</span> <span class="fl">1</span>, 
                     dr_qalys <span class="op">=</span> <span class="fl">0.03</span>, dr_costs <span class="op">=</span> <span class="fl">0.03</span>,
                     k <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">25000</span>, <span class="fl">500</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>While <code><a href="https://hesim-dev.github.io/hesim/reference/cea.html">cea_pw()</a></code> allows users to summarize output from a PSA we will just create an ICER table using means for now.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://hesim-dev.github.io/hesim/reference/icer.html">icer</a></span><span class="op">(</span><span class="va">cea_pw_out</span>, k <span class="op">=</span> <span class="fl">50000</span>, labels <span class="op">=</span> <span class="va">labs</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>##              Outcome                          New
## 1: Incremental QALYs            2.05 (1.05, 3.07)
## 2: Incremental costs   257,393 (200,711, 288,833)
## 3:   Incremental NMB -155,092 (-210,411, -75,154)
## 4:              ICER                      125,802</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Devin Incerti, Jeroen P. Jansen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
